define(["durandal/system","durandal/binder","knockout"],function(e,t,n){function i(e){var t=e[0];return"_"===t||"$"===t}function r(t){return!(!t||void 0===t.nodeType||!e.isNumber(t.nodeType))}function a(e){if(!e||r(e)||e.ko===n||e.jquery)return!1;var t=f.call(e);return-1==v.indexOf(t)&&!(e===!0||e===!1)}function o(e,t){var n=e.__observable__,i=!0;if(!n||!n.__full__){n=n||(e.__observable__={}),n.__full__=!0,g.forEach(function(n){e[n]=function(){i=!1;var e=y[n].apply(t,arguments);return i=!0,e}}),p.forEach(function(n){e[n]=function(){i&&t.valueWillMutate();var r=m[n].apply(e,arguments);return i&&t.valueHasMutated(),r}}),h.forEach(function(n){e[n]=function(){for(var r=0,a=arguments.length;a>r;r++)s(arguments[r]);i&&t.valueWillMutate();var o=m[n].apply(e,arguments);return i&&t.valueHasMutated(),o}}),e.splice=function(){for(var n=2,r=arguments.length;r>n;n++)s(arguments[n]);i&&t.valueWillMutate();var a=m.splice.apply(e,arguments);return i&&t.valueHasMutated(),a};for(var r=0,a=e.length;a>r;r++)s(e[r])}}function s(t){var r,s;if(a(t)&&(r=t.__observable__,!r||!r.__full__)){if(r=r||(t.__observable__={}),r.__full__=!0,e.isArray(t)){var c=n.observableArray(t);o(t,c)}else for(var l in t)i(l)||r[l]||(s=t[l],e.isFunction(s)||u(t,l,s));w&&e.log("Converted",t)}}function c(e,t,n){var i;e(t),i=e.peek(),n?i?i.destroyAll||o(i,e):(i=[],e(i),o(i,e)):s(i)}function u(t,i,r){var a,u,l=t.__observable__||(t.__observable__={});if(void 0===r&&(r=t[i]),e.isArray(r))a=n.observableArray(r),o(r,a),u=!0;else if("function"==typeof r){if(!n.isObservable(r))return null;a=r}else e.isPromise(r)?(a=n.observable(),r.then(function(t){if(e.isArray(t)){var i=n.observableArray(t);o(t,i),t=i}a(t)})):(a=n.observable(r),s(r));return Object.defineProperty(t,i,{configurable:!0,enumerable:!0,get:a,set:n.isWriteableObservable(a)?function(t){t&&e.isPromise(t)?t.then(function(t){c(a,t,e.isArray(t))}):c(a,t,u)}:void 0}),l[i]=a,a}function l(t,i,r){var a,o={owner:t,deferEvaluation:!0};return"function"==typeof r?o.read=r:("value"in r&&e.error('For defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof r.get&&e.error('For defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),o.read=r.get,o.write=r.set),a=n.computed(o),t[i]=a,u(t,i,a)}var d,f=Object.prototype.toString,v=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],g=["remove","removeAll","destroy","destroyAll","replace"],p=["pop","reverse","sort","shift","splice"],h=["push","unshift"],m=Array.prototype,y=n.observableArray.fn,w=!1;return d=function(e,t){var i,r,a;return e?(i=e.__observable__,i&&(r=i[t])?r:(a=e[t],n.isObservable(a)?a:u(e,t,a))):null},d.defineProperty=l,d.convertProperty=u,d.convertObject=s,d.install=function(e){var n=t.binding;t.binding=function(e,t,i){i.applyBindings&&!i.skipConversion&&s(e),n(e,t)},w=e.logConversion},d});